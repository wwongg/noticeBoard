<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header">
    <style>
        body {
            background-color: #f9f9f9;
            font-family: 'Arial', sans-serif;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .table th,
        .table td {
            vertical-align: middle;
        }

        .btn-write {
            margin-top: 20px;
        }

        .pagination .page-item.disabled .page-link {
            pointer-events: none;
            opacity: 0.5;
        }

        .search-bar {
            margin: 20px 0;
        }

        .dropdown-toggle::after {
            margin-left: 0.5rem;
        }
    </style>
</head>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
    var loginverfiy = false;

    $(document).ready(function () {
        var login = document.getElementById('loginMember_username')?.value;
        if (login) {
            loginverfiy = true;
        }
    })

    function writing() {
        if (loginverfiy) {
            window.location.href = "/boardWrit";
        } else {
            alert("로그인 먼저 해주세요");
        }
    }

    function likeson() { window.location.href = "/board/sortType?sortBoard=likeType"; }
    function manyComment() { window.location.href = "/board/sortType?sortBoard=manyCountType"; }
    function manyView() { window.location.href = "/board/sortType?sortBoard=manyViewType"; }
    function lastBoard() { window.location.href = "/board/sortType?sortBoard=lastBoardType"; }
</script>

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/}">CRUD 게시판</a>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto d-flex align-items-center">
                <div th:if="${loginMember != null}" class="d-flex align-items-center">
                    <span class="me-3" th:text="'사용자: '+${loginMember.username}"></span>
                    <form th:action="@{/logout}" method="post">
                        <button type="submit" class="btn btn-outline-danger btn-sm">로그아웃</button>
                    </form>
                </div>
                <div th:if="${loginMember==null}" class="d-flex gap-2">
                    <a class="btn btn-outline-primary btn-sm" th:href="@{/login}">로그인</a>
                    <a class="btn btn-primary btn-sm" th:href="@{/joinMember}">회원가입</a>
                </div>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Total posts -->
    <div class="mb-3">
        총 게시글 수: <span th:text="${page.totalElements}">0</span>
    </div>

    <!-- Search bar -->
    <form method="get" th:action="@{/board}">
        <div class="input-group search-bar">
            <input type="text" class="form-control" id="title" name="title" placeholder="검색어를 입력하세요">
            <button class="btn btn-primary" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                     class="bi bi-search" viewBox="0 0 16 16">
                    <path
                            d="M11.742 9.672a6.5 6.5 0 1 0-1.07 1.07l3.53 3.53a.75.75 0 0 0 1.06-1.06l-3.52-3.54zM10.5 6A4.5 4.5 0 1 1 6 1.5 4.5 4.5 0 0 1 10.5 6z" />
                </svg>
            </button>
        </div>
    </form>

    <!-- Sorting dropdown -->
    <div class="mb-3">
        <div class="btn-group">
            <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false">
                정렬기준 선택
            </button>
            <ul class="dropdown-menu">
                <li><button class="dropdown-item" type="button" onclick="lastBoard()">최신글순</button></li>
                <li><button class="dropdown-item" type="button" onclick="likeson()">좋아요순</button></li>
                <li><button class="dropdown-item" type="button" onclick="manyComment()">많은댓글순</button></li>
                <li><button class="dropdown-item" type="button" onclick="manyView()">조회수순</button></li>
            </ul>
        </div>

        <a class="btn btn-warning" th:href="@{/board/bookmarks}">내 북마크</a>
    </div>

    <!-- Board table -->
    <table class="table table-hover bg-white shadow-sm">
        <thead class="table-light">
        <tr>
            <th scope="col">#</th>
            <th scope="col">제목</th>
            <th scope="col">작성자</th>
            <th scope="col">작성일</th>
            <th scope="col">조회수</th>
        </tr>
        </thead>
        <tbody th:each="boards, loop : ${boardAll}">
        <tr>
            <th scope="row">
                <a th:href="@{/board/{id}(id=${boards.id})}"
                   th:text="${(page.pageable.pageNumber * page.pageable.pageSize) + loop.index + 1}">1</a>
            </th>
            <td>
                <span th:text="${boards.title}">제목</span>
                <span th:if="${boards.count != 0}" th:text="'('+${boards.count}+')'"
                      style="font-weight: bold"></span>
            </td>
            <td th:text="${boards.writer}">작성자</td>
            <td th:text="${#temporals.format(boards.dateTime, 'yyyy-MM-dd')}">오늘작성</td>
            <td th:text="${boards.views}">0</td>
        </tr>
        </tbody>
    </table>

    <!-- Write button -->
    <div class="d-flex justify-content-end">
        <button class="btn btn-success btn-write" onclick="writing()">글쓰기</button>
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center mt-3">
            <li class="page-item" th:classappend="${1 == page.pageable.pageNumber +1} ? 'disabled'">
                <a class="page-link" th:href="@{/board(page=${page.pageable.pageNumber - 1})}" aria-label="Previous">
                    &laquo;
                </a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(startPage,endPage)}"
                th:classappend="${i == page.pageable.pageNumber+1} ? 'disabled'">
                <a class="page-link" th:href="@{/board(page=${i} -1)}" th:text="${i}">1</a>
            </li>
            <li class="page-item" th:classappend="${page.totalPages == page.pageable.pageNumber +1 } ? 'disabled'">
                <a class="page-link" th:href="@{/board(page=${page.pageable.pageNumber+1})}">&raquo;</a>
            </li>
        </ul>
    </nav>

    <div th:if="${loginMember!=null}">
        <input type="hidden" id="loginMember_username" th:value="${loginMember.username}">
    </div>
</div>
</body>

</html>
